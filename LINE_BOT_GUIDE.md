# ü§ñ LINE Bot - ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏•‡∏ô‡πå

## üéØ ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÑ‡∏î‡πâ

### ‚úÖ ‡∏û‡∏¥‡∏°‡∏û‡πå‡πÉ‡∏ô‡πÑ‡∏•‡∏ô‡πå ‚Üí ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
```
‡∏Ñ‡∏∏‡∏ì‡∏û‡∏¥‡∏°‡∏û‡πå: "‡∏ã‡∏∑‡πâ‡∏≠‡∏õ‡∏∏‡πã‡∏¢ 800"
Bot ‡∏ï‡∏≠‡∏ö: "‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß!
         üí∞ ‡∏õ‡∏∏‡πã‡∏¢: 800 ‡∏ö‡∏≤‡∏ó
         üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: 7 ‡∏ò.‡∏Ñ. 2567"
```

### ‚úÖ ‡∏ñ‡∏≤‡∏°‡∏™‡∏£‡∏∏‡∏õ
```
‡∏Ñ‡∏∏‡∏ì‡∏û‡∏¥‡∏°‡∏û‡πå: "‡∏™‡∏£‡∏∏‡∏õ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ"
Bot ‡∏ï‡∏≠‡∏ö: "üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
         üí∏ ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: 2,350 ‡∏ö‡∏≤‡∏ó
         üìù ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: 5 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£"
```

### ‚úÖ ‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à (‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï)
```
‡∏™‡πà‡∏á‡∏£‡∏π‡∏õ ‚Üí OCR ‡∏≠‡πà‡∏≤‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç ‚Üí ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
```

---

## üöÄ Setup LINE Bot (10 ‡∏ô‡∏≤‡∏ó‡∏µ)

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏™‡∏£‡πâ‡∏≤‡∏á LINE Bot

1. **‡πÑ‡∏õ‡∏ó‡∏µ‡πà LINE Developers Console**
   - ‡πÄ‡∏õ‡∏¥‡∏î: https://developers.line.biz/console/
   - ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡πÑ‡∏•‡∏ô‡πå

2. **‡∏™‡∏£‡πâ‡∏≤‡∏á Provider**
   - ‡∏Ñ‡∏•‡∏¥‡∏Å **"Create"** ‚Üí **"Create a new provider"**
   - Provider name: **"Garden Expense Bot"**
   - ‡∏Ñ‡∏•‡∏¥‡∏Å **"Create"**

3. **‡∏™‡∏£‡πâ‡∏≤‡∏á Messaging API Channel**
   - ‡∏Ñ‡∏•‡∏¥‡∏Å **"Create a Messaging API channel"**
   - ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:
     - **Channel name**: "‡∏ö‡∏≠‡∏ó‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏™‡∏ß‡∏ô"
     - **Channel description**: "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏•‡∏ô‡πå"
     - **Category**: Finance
     - **Subcategory**: Accounting
   - ‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö Terms
   - ‡∏Ñ‡∏•‡∏¥‡∏Å **"Create"**

4. **‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Channel**
   - ‡πÑ‡∏õ‡∏ó‡∏µ‡πà Tab **"Messaging API"**
   - ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏•‡∏á‡∏´‡∏≤ **"Channel access token"**
   - ‡∏Ñ‡∏•‡∏¥‡∏Å **"Issue"** ‚Üí ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å Token
   - ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏•‡∏á‡∏´‡∏≤ **"Channel secret"**
   - ‡∏Ñ‡∏•‡∏¥‡∏Å **"Show"** ‚Üí ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å Secret

5. **‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Webhook**
   - ‡∏ó‡∏µ‡πà **"Webhook URL"**: ‡πÉ‡∏™‡πà `https://your-domain.com/webhook/line`
   - (‡πÉ‡∏ä‡πâ ngrok ‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß‡∏Å‡πá‡πÑ‡∏î‡πâ: `https://xxxx.ngrok.io/webhook/line`)
   - ‡πÄ‡∏õ‡∏¥‡∏î **"Use webhook"**: ON
   - ‡∏õ‡∏¥‡∏î **"Auto-reply messages"**: OFF
   - ‡∏õ‡∏¥‡∏î **"Greeting messages"**: OFF

6. **‡πÄ‡∏û‡∏¥‡πà‡∏° Bot ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô**
   - ‡∏™‡πÅ‡∏Å‡∏ô QR Code ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Console
   - ‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏î‡πâ‡∏ß‡∏¢ **Bot Basic ID**
   - ‡∏Å‡∏î **"‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô"**

---

## üíª Setup Backend

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á Package

```bash
cd backend
npm install @line/bot-sdk
```

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 2: ‡πÄ‡∏û‡∏¥‡πà‡∏° Config ‡πÉ‡∏ô .env

‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå `backend/.env` ‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°:

```env
# LINE Bot (Messaging API)
LINE_CHANNEL_ACCESS_TOKEN=your_channel_access_token_here
LINE_CHANNEL_SECRET=your_channel_secret_here

# LINE Notify (‡πÄ‡∏î‡∏¥‡∏° - ‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡πÑ‡∏î‡πâ)
LINE_NOTIFY_TOKEN=your_notify_token_here
```

---

## üìù ‡πÇ‡∏Ñ‡πâ‡∏î Backend

### ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà 1: line-bot.js (‡πÉ‡∏´‡∏°‡πà)

‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `backend/line-bot.js`:

```javascript
const line = require('@line/bot-sdk');
const { pool } = require('./database');

// LINE Bot Configuration
const config = {
  channelAccessToken: process.env.LINE_CHANNEL_ACCESS_TOKEN,
  channelSecret: process.env.LINE_CHANNEL_SECRET
};

const client = new line.Client(config);

/**
 * Parse ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢
 * ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö: "‡∏ã‡∏∑‡πâ‡∏≠‡∏õ‡∏∏‡πã‡∏¢ 800" ‡∏´‡∏£‡∏∑‡∏≠ "‡∏õ‡∏∏‡πã‡∏¢ 800"
 */
const parseExpenseMessage = (text) => {
  // ‡∏•‡∏ö‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ "‡∏ã‡∏∑‡πâ‡∏≠" ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
  const cleaned = text.replace(/^‡∏ã‡∏∑‡πâ‡∏≠\s*/, '').trim();
  
  // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö: "‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô"
  const regex = /^(.+?)\s+(\d+(?:\.\d{1,2})?)(?:\s*‡∏ö‡∏≤‡∏ó)?$/;
  const match = cleaned.match(regex);
  
  if (!match) {
    return null;
  }
  
  const description = match[1].trim();
  const amount = parseFloat(match[2]);
  
  // ‡∏´‡∏≤‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏à‡∏≤‡∏Å keyword
  const categoryMap = {
    '‡∏õ‡∏∏‡πã‡∏¢': 1,
    '‡πÄ‡∏°‡∏•‡πá‡∏î': 2,
    '‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå': 2,
    '‡∏ô‡πâ‡∏≥': 3,
    '‡πÅ‡∏£‡∏á': 4,
    '‡∏à‡πâ‡∏≤‡∏á': 4,
    '‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå': 5,
    '‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠': 5,
    '‡∏¢‡∏≤': 6,
    '‡∏û‡πà‡∏ô': 6,
    '‡∏Ç‡∏ô‡∏™‡πà‡∏á': 7,
    '‡∏™‡πà‡∏á': 7,
    '‡πÑ‡∏ü': 8,
    '‡πÑ‡∏ü‡∏ü‡πâ‡∏≤': 8,
    '‡∏ã‡πà‡∏≠‡∏°': 9,
    '‡∏ö‡∏≥‡∏£‡∏∏‡∏á': 9
  };
  
  let categoryId = 10; // default: ‡∏≠‡∏∑‡πà‡∏ô‡πÜ
  for (const [keyword, id] of Object.entries(categoryMap)) {
    if (description.includes(keyword)) {
      categoryId = id;
      break;
    }
  }
  
  return {
    category_id: categoryId,
    amount: amount,
    description: description,
    date: new Date().toISOString().split('T')[0]
  };
};

/**
 * ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢
 */
const saveExpense = async (expenseData) => {
  try {
    const query = `
      INSERT INTO transactions (type, category_id, amount, description, date)
      VALUES ('expense', ?, ?, ?, ?)
    `;
    
    const [result] = await pool.query(query, [
      expenseData.category_id,
      expenseData.amount,
      expenseData.description,
      expenseData.date
    ]);
    
    // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà
    const [transaction] = await pool.query(`
      SELECT t.*, c.name as category_name
      FROM transactions t
      LEFT JOIN categories c ON t.category_id = c.id
      WHERE t.id = ?
    `, [result.insertId]);
    
    return transaction[0];
  } catch (error) {
    console.error('Error saving expense:', error);
    throw error;
  }
};

/**
 * ‡∏î‡∏∂‡∏á‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
 */
const getTodaySummary = async () => {
  try {
    const today = new Date().toISOString().split('T')[0];
    
    const [summary] = await pool.query(`
      SELECT 
        SUM(amount) as total,
        COUNT(*) as count
      FROM transactions
      WHERE type = 'expense' AND date = ?
    `, [today]);
    
    const [categories] = await pool.query(`
      SELECT 
        c.name,
        SUM(t.amount) as total
      FROM transactions t
      JOIN categories c ON t.category_id = c.id
      WHERE t.type = 'expense' AND t.date = ?
      GROUP BY c.id, c.name
      ORDER BY total DESC
      LIMIT 5
    `, [today]);
    
    return {
      total: summary[0].total || 0,
      count: summary[0].count || 0,
      categories: categories
    };
  } catch (error) {
    console.error('Error getting summary:', error);
    throw error;
  }
};

/**
 * ‡∏à‡∏±‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö
 */
const formatSuccessMessage = (transaction) => {
  const amount = parseFloat(transaction.amount).toLocaleString('th-TH', {
    minimumFractionDigits: 2,
    maximumFractionDigits: 2
  });
  
  const date = new Date(transaction.date).toLocaleDateString('th-TH', {
    day: '2-digit',
    month: 'short',
    year: 'numeric'
  });
  
  return `‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß!
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üí∞ ${transaction.category_name || '‡∏≠‡∏∑‡πà‡∏ô‡πÜ'}: ${amount} ‡∏ö‡∏≤‡∏ó
üìù ${transaction.description}
üìÖ ${date}
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ`;
};

const formatSummaryMessage = (data) => {
  const total = parseFloat(data.total).toLocaleString('th-TH', {
    minimumFractionDigits: 2,
    maximumFractionDigits: 2
  });
  
  const today = new Date().toLocaleDateString('th-TH', {
    day: '2-digit',
    month: 'short',
    year: 'numeric'
  });
  
  let message = `üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
${today}
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üí∏ ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: ${total} ‡∏ö‡∏≤‡∏ó
üìù ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${data.count} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
  
  if (data.categories.length > 0) {
    message += '\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\nüìÇ Top 5 ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà:';
    data.categories.forEach(cat => {
      const catAmount = parseFloat(cat.total).toLocaleString('th-TH', {
        minimumFractionDigits: 2
      });
      message += `\n‚Ä¢ ${cat.name}: ${catAmount} ‡∏ö‡∏≤‡∏ó`;
    });
  }
  
  message += '\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ';
  return message;
};

const formatHelpMessage = () => {
  return `üå± ‡∏ö‡∏≠‡∏ó‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏™‡∏ß‡∏ô

üìù ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:

1Ô∏è‚É£ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢:
   "‡∏ã‡∏∑‡πâ‡∏≠‡∏õ‡∏∏‡πã‡∏¢ 800"
   "‡πÄ‡∏°‡∏•‡πá‡∏î‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå 450"
   "‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á 2000"

2Ô∏è‚É£ ‡∏î‡∏π‡∏™‡∏£‡∏∏‡∏õ:
   "‡∏™‡∏£‡∏∏‡∏õ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ"
   "‡∏™‡∏£‡∏∏‡∏õ"

3Ô∏è‚É£ ‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠:
   "help"
   "‡∏ä‡πà‡∏ß‡∏¢"

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üìÇ ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö:
‚Ä¢ ‡∏õ‡∏∏‡πã‡∏¢
‚Ä¢ ‡πÄ‡∏°‡∏•‡πá‡∏î‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå
‚Ä¢ ‡∏ô‡πâ‡∏≥
‚Ä¢ ‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á
‚Ä¢ ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå
‚Ä¢ ‡∏¢‡∏≤‡∏Å‡∏≥‡∏à‡∏±‡∏î‡∏®‡∏±‡∏ï‡∏£‡∏π‡∏û‡∏∑‡∏ä
‚Ä¢ ‡∏Ñ‡πà‡∏≤‡∏Ç‡∏ô‡∏™‡πà‡∏á
‚Ä¢ ‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü‡∏ü‡πâ‡∏≤
‚Ä¢ ‡∏ã‡πà‡∏≠‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á
‚Ä¢ ‡∏≠‡∏∑‡πà‡∏ô‡πÜ`;
};

/**
 * Handle ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å LINE
 */
const handleMessage = async (event) => {
  if (event.type !== 'message' || event.message.type !== 'text') {
    return null;
  }
  
  const text = event.message.text.trim();
  const userId = event.source.userId;
  
  try {
    // ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏û‡∏¥‡πÄ‡∏®‡∏©
    if (['‡∏™‡∏£‡∏∏‡∏õ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ', '‡∏™‡∏£‡∏∏‡∏õ', 'summary'].includes(text.toLowerCase())) {
      const summary = await getTodaySummary();
      if (summary.count === 0) {
        return { type: 'text', text: '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ' };
      }
      return { type: 'text', text: formatSummaryMessage(summary) };
    }
    
    if (['help', '‡∏ä‡πà‡∏ß‡∏¢', '‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠', '‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ'].includes(text.toLowerCase())) {
      return { type: 'text', text: formatHelpMessage() };
    }
    
    // ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏° Parse ‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢
    const expenseData = parseExpenseMessage(text);
    
    if (!expenseData) {
      return {
        type: 'text',
        text: '‚ùå ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á\n\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏û‡∏¥‡∏°‡∏û‡πå:\n"‡∏ã‡∏∑‡πâ‡∏≠‡∏õ‡∏∏‡πã‡∏¢ 800"\n‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå "help" ‡∏î‡∏π‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ'
      };
    }
    
    // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢
    const transaction = await saveExpense(expenseData);
    return { type: 'text', text: formatSuccessMessage(transaction) };
    
  } catch (error) {
    console.error('Error handling message:', error);
    return {
      type: 'text',
      text: '‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á'
    };
  }
};

module.exports = {
  config,
  client,
  handleMessage,
  parseExpenseMessage,
  saveExpense,
  getTodaySummary
};
```

---

### ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà 2: ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç server.js

‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏Ñ‡πâ‡∏î‡∏ô‡∏µ‡πâ‡πÉ‡∏ô `backend/server.js`:

```javascript
// ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏µ‡πà‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ö‡∏ô‡∏™‡∏∏‡∏î (‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å require ‡∏≠‡∏∑‡πà‡∏ô‡πÜ)
const line = require('@line/bot-sdk');
const lineBot = require('./line-bot');

// ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡πà‡∏≠‡∏ô initializeDatabase()
// ==================== LINE Bot Webhook ====================

app.post('/webhook/line', line.middleware(lineBot.config), async (req, res) => {
  try {
    const events = req.body.events;
    
    const results = await Promise.all(
      events.map(async (event) => {
        const message = await lineBot.handleMessage(event);
        
        if (message) {
          return lineBot.client.replyMessage(event.replyToken, message);
        }
      })
    );
    
    res.json({ success: true });
  } catch (error) {
    console.error('LINE webhook error:', error);
    res.status(500).json({ error: error.message });
  }
});

// ‡πÄ‡∏û‡∏¥‡πà‡∏° endpoint ‡∏ó‡∏î‡∏™‡∏≠‡∏ö
app.get('/webhook/line', (req, res) => {
  res.json({ 
    status: 'LINE Bot webhook is ready',
    configured: !!process.env.LINE_CHANNEL_ACCESS_TOKEN
  });
});
```

---

## üåê Setup Webhook URL (‡πÉ‡∏ä‡πâ ngrok)

### ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á ngrok

1. **‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î ngrok**
   - ‡πÑ‡∏õ‡∏ó‡∏µ‡πà: https://ngrok.com/download
   - ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á

2. **‡∏£‡∏±‡∏ô ngrok**
   ```bash
   # ‡πÄ‡∏õ‡∏¥‡∏î Terminal ‡πÉ‡∏´‡∏°‡πà
   ngrok http 3001
   ```

3. **‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å URL**
   ```
   Forwarding: https://xxxx-xx-xx-xx-xx.ngrok-free.app -> http://localhost:3001
   ```
   ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å URL ‡∏ó‡∏µ‡πà‡∏Ç‡∏∂‡πâ‡∏ô‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢ `https://`

4. **‡πÉ‡∏™‡πà‡πÉ‡∏ô LINE Console**
   - ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ó‡∏µ‡πà LINE Developers Console
   - Tab "Messaging API"
   - Webhook URL: `https://xxxx.ngrok-free.app/webhook/line`
   - ‡∏Ñ‡∏•‡∏¥‡∏Å "Update"
   - ‡∏Ñ‡∏•‡∏¥‡∏Å "Verify" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö

---

## ‚úÖ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö

### 1. Restart Backend
```bash
# ‡∏Å‡∏î Ctrl+C ‡∏´‡∏¢‡∏∏‡∏î Backend
cd backend
npm start
```

‡∏Ñ‡∏ß‡∏£‡πÄ‡∏´‡πá‡∏ô:
```
üöÄ Server is running on http://localhost:3001
üí¨ LINE Notify: ‚úÖ Configured
ü§ñ LINE Bot: ‚úÖ Configured
```

### 2. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Webhook
```bash
curl http://localhost:3001/webhook/line
```

‡∏Ñ‡∏ß‡∏£‡πÑ‡∏î‡πâ:
```json
{
  "status": "LINE Bot webhook is ready",
  "configured": true
}
```

### 3. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÉ‡∏ô‡πÑ‡∏•‡∏ô‡πå

‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏•‡∏ô‡πå ‚Üí ‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏ä‡∏ó‡∏Å‡∏±‡∏ö Bot:

**‡∏ó‡∏î‡∏™‡∏≠‡∏ö 1: ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢**
```
‡∏Ñ‡∏∏‡∏ì‡∏û‡∏¥‡∏°‡∏û‡πå: ‡∏ã‡∏∑‡πâ‡∏≠‡∏õ‡∏∏‡πã‡∏¢ 800
Bot ‡∏ï‡∏≠‡∏ö: ‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß!
        üí∞ ‡∏õ‡∏∏‡πã‡∏¢: 800.00 ‡∏ö‡∏≤‡∏ó
        üìù ‡∏ã‡∏∑‡πâ‡∏≠‡∏õ‡∏∏‡πã‡∏¢
        üìÖ 7 ‡∏ò.‡∏Ñ. 2567
```

**‡∏ó‡∏î‡∏™‡∏≠‡∏ö 2: ‡∏î‡∏π‡∏™‡∏£‡∏∏‡∏õ**
```
‡∏Ñ‡∏∏‡∏ì‡∏û‡∏¥‡∏°‡∏û‡πå: ‡∏™‡∏£‡∏∏‡∏õ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
Bot ‡∏ï‡∏≠‡∏ö: üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
        üí∏ ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: 2,350.00 ‡∏ö‡∏≤‡∏ó
        üìù ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: 5 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
```

**‡∏ó‡∏î‡∏™‡∏≠‡∏ö 3: Help**
```
‡∏Ñ‡∏∏‡∏ì‡∏û‡∏¥‡∏°‡∏û‡πå: help
Bot ‡∏ï‡∏≠‡∏ö: üå± ‡∏ö‡∏≠‡∏ó‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏™‡∏ß‡∏ô
        ...‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô...
```

---

## üì± ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ó‡∏µ‡πà Bot ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à

### ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢
```
‚úÖ "‡∏ã‡∏∑‡πâ‡∏≠‡∏õ‡∏∏‡πã‡∏¢ 800"
‚úÖ "‡∏õ‡∏∏‡πã‡∏¢ 800"
‚úÖ "‡πÄ‡∏°‡∏•‡πá‡∏î‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå 450"
‚úÖ "‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á 2000"
‚úÖ "‡∏ô‡πâ‡∏≥ 350 ‡∏ö‡∏≤‡∏ó"
‚ùå "‡∏õ‡∏∏‡πã‡∏¢" (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô)
‚ùå "800 ‡∏ö‡∏≤‡∏ó" (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î)
```

### ‡∏î‡∏π‡∏™‡∏£‡∏∏‡∏õ
```
‚úÖ "‡∏™‡∏£‡∏∏‡∏õ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ"
‚úÖ "‡∏™‡∏£‡∏∏‡∏õ"
‚úÖ "summary"
```

### ‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠
```
‚úÖ "help"
‚úÖ "‡∏ä‡πà‡∏ß‡∏¢"
‚úÖ "‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠"
‚úÖ "‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ"
```

---

## üéØ ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á

```
09:00 - ‡∏Ñ‡∏∏‡∏ì: "‡∏ã‡∏∑‡πâ‡∏≠‡∏õ‡∏∏‡πã‡∏¢ 800"
09:00 - Bot: "‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß! ‡∏õ‡∏∏‡πã‡∏¢: 800 ‡∏ö‡∏≤‡∏ó"

10:30 - ‡∏Ñ‡∏∏‡∏ì: "‡πÄ‡∏°‡∏•‡πá‡∏î‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå 450"
10:30 - Bot: "‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß! ‡πÄ‡∏°‡∏•‡πá‡∏î‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå: 450 ‡∏ö‡∏≤‡∏ó"

12:00 - ‡∏Ñ‡∏∏‡∏ì: "‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á 2000"
12:00 - Bot: "‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß! ‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á: 2,000 ‡∏ö‡∏≤‡∏ó"

20:00 - ‡∏Ñ‡∏∏‡∏ì: "‡∏™‡∏£‡∏∏‡∏õ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ"
20:00 - Bot: "üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
              üí∏ ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: 3,250 ‡∏ö‡∏≤‡∏ó
              üìù ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: 3 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£"
```

---

## üí∞ ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢

### LINE Messaging API
- **‡∏ü‡∏£‡∏µ**: 500 ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
- **Pro**: ~300 ‡∏ö‡∏≤‡∏ó/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (‡πÑ‡∏°‡πà‡∏à‡∏≥‡∏Å‡∏±‡∏î)

### ngrok
- **‡∏ü‡∏£‡∏µ**: ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ ‡πÅ‡∏ï‡πà URL ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ô
- **Pro**: ~$8/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (URL ‡∏Ñ‡∏á‡∏ó‡∏µ‡πà)

### ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:
‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏î‡πâ‡∏ß‡∏¢ **‡∏ü‡∏£‡∏µ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î** ‡πÑ‡∏õ‡∏Å‡πà‡∏≠‡∏ô!

---

## üöÄ Deploy (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á)

‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏û‡∏£‡πâ‡∏≠‡∏° Deploy:

1. **Backend** ‚Üí Railway / Render
2. **Frontend** ‚Üí Vercel
3. **Database** ‚Üí PlanetScale / Railway MySQL
4. **Webhook URL** ‚Üí ‡πÉ‡∏ä‡πâ Railway URL ‡πÅ‡∏ó‡∏ô ngrok

‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ó‡∏µ‡πà **PRODUCTION_ROADMAP.md**

---

## ‚ùì ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤

### Bot ‡πÑ‡∏°‡πà‡∏ï‡∏≠‡∏ö

**1. ‡πÄ‡∏ä‡πá‡∏Ñ Webhook**
```bash
curl https://your-ngrok-url.ngrok-free.app/webhook/line
```

**2. ‡πÄ‡∏ä‡πá‡∏Ñ LINE Console**
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö "Use webhook" ‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Webhook URL ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
- ‡∏•‡∏≠‡∏á "Verify" webhook

**3. ‡πÄ‡∏ä‡πá‡∏Ñ Backend Log**
```bash
# ‡∏î‡∏π‡πÉ‡∏ô Terminal ‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ô Backend
# ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏´‡πá‡∏ô log ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤
```

**4. ‡πÄ‡∏ä‡πá‡∏Ñ Token**
```env
# ‡πÉ‡∏ô .env ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ
LINE_CHANNEL_ACCESS_TOKEN=...
LINE_CHANNEL_SECRET=...
```

### ngrok ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏

- ngrok Free ‡∏à‡∏∞‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡∏ó‡∏∏‡∏Å 2 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á
- ‡∏£‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏•‡πâ‡∏ß Update Webhook URL ‡πÉ‡∏ô LINE Console

---

## üéâ ‡∏™‡∏£‡∏∏‡∏õ

‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ:
- ‚úÖ ‡∏û‡∏¥‡∏°‡∏û‡πå‡πÉ‡∏ô‡πÑ‡∏•‡∏ô‡πå ‚Üí ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
- ‚úÖ Bot ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
- ‚úÖ ‡∏ñ‡∏≤‡∏°‡∏™‡∏£‡∏∏‡∏õ‡πÑ‡∏î‡πâ
- ‚úÖ ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ü‡∏£‡∏µ!

**‡∏Ñ‡∏£‡∏ö‡∏ó‡∏±‡πâ‡∏á 2 ‡∏£‡∏∞‡∏ö‡∏ö:**
1. LINE Notify ‚Üí ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
2. LINE Bot ‚Üí ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏î‡πâ

---

**Happy Chatting! üí¨üå±**
